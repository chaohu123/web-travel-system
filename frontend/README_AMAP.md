# 高德地图API配置说明

## 配置步骤

### 1. 获取高德地图API Key

1. 访问 [高德开放平台](https://console.amap.com/)
2. 注册/登录账号
3. 进入「应用管理」→「我的应用」
4. 点击「创建新应用」
5. 填写应用信息，选择「Web端(JS API)」
6. 添加Key，配置安全密钥（可选，建议配置）
7. 复制生成的Key

### 2. 配置环境变量

在 `frontend` 目录下创建 `.env` 文件（参考 `.env.example`）：

```bash
# 高德地图API Key
VITE_AMAP_KEY=你的高德地图API_Key
```

### 3. 重启开发服务器

配置完成后，需要重启开发服务器：

```bash
npm run dev
```

## 功能说明

### 路线详情页
- 显示路线上所有景点的位置标记
- 按天绘制不同颜色的路线
- 点击标记点可查看景点详细信息
- 自动调整地图视野以包含所有景点

### 景点详情页
- 显示景点的精确位置
- 通过地理编码将地址转换为坐标
- 点击标记点可查看景点信息

## 注意事项

1. **API Key限制**：
   - 免费版每日有调用次数限制
   - 建议配置安全密钥以提高安全性
   - 生产环境建议使用HTTPS

2. **地理编码**：
   - 地址需要尽可能详细（包含城市、区县、街道）
   - 如果地理编码失败，会使用默认坐标（北京）

3. **地图样式**：
   - 当前使用深色主题（`amap://styles/darkblue`）
   - 可在 `utils/amap.ts` 中修改 `mapStyle` 参数

## 故障排查

### 控制台报错「Failed to load AMap script」（脚本加载失败）
常见原因与处理方式：
1. **网络问题**：确认能访问 `https://webapi.amap.com`，检查防火墙/代理是否拦截。
2. **API Key 与白名单**：在高德控制台「应用管理」→ 对应应用 → Key 设置中，将 **「服务平台」** 勾选为「Web端(JS API)」，并在 **「Key 的域名白名单」** 中添加当前访问地址，例如：
   - 本地开发：`localhost`、`127.0.0.1`
   - 若使用 IP 访问：你的本机 IP（如 `192.168.x.x`）
   - 上线后：你的正式域名（如 `https://your-domain.com`）
3. **浏览器/扩展拦截**：部分浏览器（如 Edge）的跟踪防护或广告拦截扩展可能阻止外部脚本，可尝试关闭相关功能或在隐私/安全设置中放行高德域名。
4. **环境变量未生效**：修改 `.env` 后需重启开发服务器（`npm run dev`）。

### 地图不显示
1. 检查 `.env` 文件中的 `VITE_AMAP_KEY` 是否正确配置
2. 检查浏览器控制台是否有错误信息
3. 确认高德地图API Key是否有效且有足够的调用次数

### 地理编码失败
1. 检查地址信息是否完整
2. 查看控制台是否有相关错误信息
3. 如果地址不准确，地图会使用默认坐标

## 相关文件

- `frontend/src/utils/amap.ts` - 高德地图工具类
- `frontend/src/views/RouteDetailView.vue` - 路线详情页
- `frontend/src/views/SpotDetailView.vue` - 景点详情页
- `frontend/.env.example` - 环境变量示例文件
